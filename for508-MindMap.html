<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.17.0/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.17.0/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.17.0/dist/index.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"Windows Forensics","children":[{"content":"Malware Persistence","children":[{"content":"AutoStart locations","children":[{"content":"NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Run","children":[],"payload":{"lines":"4,5"}},{"content":"NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce","children":[],"payload":{"lines":"5,6"}},{"content":"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\Explorer\\Run","children":[],"payload":{"lines":"6,7"}},{"content":"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce","children":[],"payload":{"lines":"7,8"}},{"content":"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run","children":[],"payload":{"lines":"8,9"}},{"content":"SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit","children":[],"payload":{"lines":"9,10"}},{"content":"%AppData%\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup","children":[],"payload":{"lines":"10,11"}},{"content":"SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run","children":[],"payload":{"lines":"11,12"}},{"content":"SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\RunOnce","children":[],"payload":{"lines":"12,13"}}],"payload":{"lines":"3,4"}},{"content":"Service Creation/Replacement","children":[{"content":"HKML\\SYSTEM\\CurrentControlSet\\Services","children":[{"content":"Start with 0x02 : Automatic","children":[],"payload":{"lines":"15,16"}},{"content":"Start with 0x00 : Boot start of a device driver","children":[],"payload":{"lines":"16,17"}}],"payload":{"lines":"14,15"}},{"content":"Links","children":[{"content":"<a href=\"https://for508.com/28vic/\">Mandiant APT1</a>","children":[],"payload":{"lines":"18,19"}},{"content":"<a href=\"https://for508.com/wc1u-/\">Peering into GlassRAT</a>","children":[],"payload":{"lines":"19,20"}},{"content":"<a href=\"https://for508.com/ojzea/\">Stealthy Malware Persistence</a>","children":[],"payload":{"lines":"20,21"}}],"payload":{"lines":"17,18"}}],"payload":{"lines":"13,14"}},{"content":"Scheduled Tasks","children":[{"content":"C:\\Windows\\Tasks","children":[],"payload":{"lines":"22,23"}},{"content":"C:\\Windows\\System32\\Tasks","children":[],"payload":{"lines":"23,24"}},{"content":"C:\\Windows\\Schedlgu.txt - XP only","children":[],"payload":{"lines":"24,25"}},{"content":"If TaskScheduler &amp; a process have the same PPID =&gt; process has been launched by the taskscheduler","children":[],"payload":{"lines":"25,26"}}],"payload":{"lines":"21,22"}},{"content":"DLL Hijacking","children":[{"content":"Links","children":[{"content":"<a href=\"https://for508.com/v2su7/\">Malware Persistence without the Windows Registry</a>","children":[],"payload":{"lines":"28,29"}},{"content":"<a href=\"https://for508.com/9j5np/\">DLL Search order</a>","children":[],"payload":{"lines":"29,30"}},{"content":"<a href=\"https://for508.com/m4frx/\">Phantom DLL</a>","children":[],"payload":{"lines":"30,31"}},{"content":"<a href=\"https://for508.com/sgeyk/\">What The Fxsst</a>","children":[],"payload":{"lines":"31,32"}},{"content":"<a href=\"https://for508.com/z8ni0/\">DLL Side-Loader</a>","children":[],"payload":{"lines":"32,33"}},{"content":"<a href=\"https://for508.com/78nj2/\">NetTraveler</a>","children":[],"payload":{"lines":"33,34"}},{"content":"<a href=\"https://for508.com/lkpf9/\">DLL rules in AppLocker</a>","children":[],"payload":{"lines":"34,35"}}],"payload":{"lines":"27,28"}},{"content":"Hunting","children":[{"content":"File System analyse: search .dll/.exe in unusual path","children":[],"payload":{"lines":"36,37"}},{"content":"Memory analyse: search DLL loaded from wrong location","children":[],"payload":{"lines":"37,38"}},{"content":"<a href=\"https://for508.com/tsgpy/\">Hunting with Velociraptor</a>","children":[],"payload":{"lines":"38,39"}}],"payload":{"lines":"35,36"}}],"payload":{"lines":"26,27"}},{"content":"WMI Event Consumers","children":[{"content":"Info","children":[{"content":"Event Filter + Event Consumer + Binding =&gt; WMI","children":[],"payload":{"lines":"41,42"}},{"content":"PowerShell/mofcomp.exe to setup","children":[],"payload":{"lines":"42,43"}}],"payload":{"lines":"40,41"}},{"content":"Hunting","children":[{"content":"SysInternal Autorun","children":[],"payload":{"lines":"44,45"}},{"content":"Kansa PowerShell framework","children":[],"payload":{"lines":"45,46"}},{"content":"PowerShell cmdlet Get-WmiObject","children":[{"content":"Get-WMIObject -Namespace rootSubscription -Class __EventFilter","children":[],"payload":{"lines":"47,48"}},{"content":"Get-WMIObject -Namespace rootSubscription -Class __EventConsumer","children":[],"payload":{"lines":"48,49"}},{"content":"Get-WMIObject -Namespace rootSubscription -Class __FilterToConsumerBinding","children":[],"payload":{"lines":"49,50"}}],"payload":{"lines":"46,47"}}],"payload":{"lines":"43,44"}},{"content":"Links","children":[{"content":"<a href=\"https://for508.com/2jh-f/\">Monitoring Events</a>","children":[],"payload":{"lines":"51,52"}},{"content":"<a href=\"https://for508.com/lj9em/\">Stuxnet Under Microscope</a>","children":[],"payload":{"lines":"52,53"}},{"content":"<a href=\"https://for508.com/kc36x/\">There's nothing About WMI</a>","children":[],"payload":{"lines":"53,54"}},{"content":"<a href=\"https://for508.com/c36i8/\">Kansa &amp; WMI Event Consumer</a>","children":[],"payload":{"lines":"54,55"}},{"content":"<a href=\"https://for508.com/q1r94/\">ELK Stack</a>","children":[],"payload":{"lines":"55,56"}}],"payload":{"lines":"50,51"}}],"payload":{"lines":"39,40"}},{"content":"More Advanced","children":[{"content":"Local GPO","children":[],"payload":{"lines":"57,58"}},{"content":"MS Office Add-In","children":[],"payload":{"lines":"58,59"}},{"content":"BIOS flashing","children":[],"payload":{"lines":"59,61"}}],"payload":{"lines":"56,57"}}],"payload":{"lines":"2,3"}},{"content":"Credential theft","children":[{"content":"Compromission tools","children":[{"content":"Incognito","children":[],"payload":{"lines":"63,64"}},{"content":"MetaSploit","children":[],"payload":{"lines":"64,65"}},{"content":"Powershell","children":[],"payload":{"lines":"65,66"}},{"content":"Mimikatz","children":[],"payload":{"lines":"66,67"}},{"content":"fgdump","children":[],"payload":{"lines":"67,68"}},{"content":"gsecdump","children":[],"payload":{"lines":"68,69"}},{"content":"AceHash","children":[],"payload":{"lines":"69,70"}},{"content":"PWDumpX","children":[],"payload":{"lines":"70,71"}},{"content":"creddump","children":[],"payload":{"lines":"71,72"}},{"content":"WCE","children":[],"payload":{"lines":"72,73"}},{"content":"Cachedump","children":[],"payload":{"lines":"73,74"}},{"content":"Cain","children":[],"payload":{"lines":"74,75"}},{"content":"Kerberoasting","children":[],"payload":{"lines":"75,76"}},{"content":"ntdsutil","children":[],"payload":{"lines":"76,77"}},{"content":"VSSAdmin","children":[],"payload":{"lines":"77,78"}},{"content":"NTDSXtract","children":[],"payload":{"lines":"78,79"}},{"content":"secretsdump.py","children":[],"payload":{"lines":"79,80"}},{"content":"Bloodhound + Empire with Death Star","children":[],"payload":{"lines":"80,81"}},{"content":"GoFetch","children":[],"payload":{"lines":"81,82"}}],"payload":{"lines":"62,63"}},{"content":"Hunting","children":[{"content":"EventLog 4624","children":[{"content":"<table data-lines=\"84,96\">\n<thead data-lines=\"84,85\">\n<tr data-lines=\"84,85\">\n<th>Admin action</th>\n<th>Logon Type</th>\n<th>Creds on target?</th>\n<th>Notes</th>\n</tr>\n</thead>\n<tbody data-lines=\"86,96\">\n<tr data-lines=\"86,87\">\n<td>Console logon</td>\n<td>2</td>\n<td>Yes*</td>\n<td>* Except when Credential Guard is enabled</td>\n</tr>\n<tr data-lines=\"87,88\">\n<td>Run as</td>\n<td>2</td>\n<td>Yes*</td>\n<td>* Except when Credential Guard is enabled</td>\n</tr>\n<tr data-lines=\"88,89\">\n<td>Remote desktop</td>\n<td>10</td>\n<td>Yes*</td>\n<td>* Except when Credential Guard is enabled</td>\n</tr>\n<tr data-lines=\"89,90\">\n<td>Net Use</td>\n<td>3</td>\n<td>No</td>\n<td>Including /u: parameter</td>\n</tr>\n<tr data-lines=\"90,91\">\n<td>Powershell Remoting</td>\n<td>3</td>\n<td>No</td>\n<td>Invoke-Command or Enter-PSSession</td>\n</tr>\n<tr data-lines=\"91,92\">\n<td>PsExec alternate creds</td>\n<td>3 + 2</td>\n<td>Yes</td>\n<td>-u <username> -p <password></password></username></td>\n</tr>\n<tr data-lines=\"92,93\">\n<td>PsExec w/o explicit creds</td>\n<td>3</td>\n<td>No</td>\n<td></td>\n</tr>\n<tr data-lines=\"93,94\">\n<td>Remote Scheduled Task</td>\n<td>4</td>\n<td>Yes</td>\n<td>Password saved as LSA Secret</td>\n</tr>\n<tr data-lines=\"94,95\">\n<td>Runas service</td>\n<td>5</td>\n<td>Yes</td>\n<td>(w/user account) - Password saved as LSA Secret</td>\n</tr>\n<tr data-lines=\"95,96\">\n<td>Remote registry</td>\n<td>3</td>\n<td>No</td>\n<td></td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"lines":"84,96"}}],"payload":{"lines":"83,84"}},{"content":"HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest with \"UseLogonCredential\" set to 1","children":[],"payload":{"lines":"96,97"}}],"payload":{"lines":"82,83"}},{"content":"Info","children":[{"content":"Hashes","children":[{"content":"Defending","children":[{"content":"Stop remote interactive session with highly priviledged accounts","children":[],"payload":{"lines":"100,101"}},{"content":"Ensure local admin account passwords are unique &amp; not shared","children":[],"payload":{"lines":"101,102"}},{"content":"Proper termination of RDP sessions","children":[{"content":"Win8+:  force use of Restricted Admin","children":[],"payload":{"lines":"103,104"}},{"content":"Win10+: deploy Remote Credential Guard","children":[],"payload":{"lines":"104,105"}}],"payload":{"lines":"102,103"}},{"content":"Upgrade to Win10+","children":[{"content":"Credential Guard","children":[],"payload":{"lines":"106,107"}},{"content":"WDigest &amp; TsPkg creds no longer stored by default","children":[],"payload":{"lines":"107,108"}},{"content":"Domain protected users (mitiagte Pass The Hash attacks)","children":[],"payload":{"lines":"108,109"}}],"payload":{"lines":"105,106"}}],"payload":{"lines":"99,100"}},{"content":"Links","children":[{"content":"<a href=\"https://for508.com/q1v9h\">Microsoft Security Advisory Update to Improve credentials Protection</a>","children":[],"payload":{"lines":"110,111"}},{"content":"<a href=\"https://for508.com/306oh/\">Technet credentials protection &amp; Mgmt</a>","children":[],"payload":{"lines":"111,112"}},{"content":"<a href=\"https://for508.com/zve0b\">Blocking remote use of local accounts</a>","children":[],"payload":{"lines":"112,113"}},{"content":"<a href=\"https://for508.com/mbrx6\">Local Administrator Password solution</a>","children":[],"payload":{"lines":"113,114"}}],"payload":{"lines":"109,110"}}],"payload":{"lines":"98,99"}},{"content":"Token","children":[{"content":"Hunting / Defending","children":[{"content":"Investigate users with SeImpersonate privilege","children":[],"payload":{"lines":"116,117"}},{"content":"Apply same defending actions as hashes password","children":[],"payload":{"lines":"117,118"}},{"content":"Use \"Restricted Admin","children":[],"payload":{"lines":"118,119"}},{"content":"Use \"Protected Users\" security group","children":[],"payload":{"lines":"119,120"}}],"payload":{"lines":"115,116"}},{"content":"Links","children":[{"content":"<a href=\"http://for508.com/zmyn0\">Safeguarding Access Tokens</a>","children":[],"payload":{"lines":"121,122"}},{"content":"<a href=\"http://for508.com/6zblt\">Security implications of Windows Acess Token</a>","children":[],"payload":{"lines":"122,123"}},{"content":"<a href=\"http://for508.com/4nv9m\">Monitoring delegation Token</a>","children":[],"payload":{"lines":"123,124"}},{"content":"<a href=\"http://for508.com/6c0n3\">Safeguarding Access Tokens</a>","children":[],"payload":{"lines":"124,125"}},{"content":"<a href=\"http://for508.com/k69i3\">Technet credentials protection &amp; mgmt</a>","children":[],"payload":{"lines":"125,126"}},{"content":"<a href=\"http://for508.com/khltc\">\"Account is sensitive &amp; cannot be delegated\"</a>","children":[],"payload":{"lines":"126,127"}},{"content":"<a href=\"http://for508.com/hm6po\">Technet Protected Users Security Group</a>","children":[],"payload":{"lines":"127,128"}}],"payload":{"lines":"120,121"}}],"payload":{"lines":"114,115"}},{"content":"Cached credentials","children":[{"content":"Info","children":[{"content":"Cannot be used for Pass-The-Hash attack","children":[],"payload":{"lines":"130,131"}},{"content":"Cached credentials much be cracked","children":[],"payload":{"lines":"131,132"}},{"content":"Hashes are case-sensitive &amp; salted","children":[],"payload":{"lines":"132,133"}},{"content":"Service accounts &amp; computer accounts are also cached","children":[],"payload":{"lines":"133,134"}}],"payload":{"lines":"129,130"}},{"content":"Hunting/Defending","children":[{"content":"SECURITY\\Cache key","children":[],"payload":{"lines":"135,136"}},{"content":"\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon CachedLogonsCount set to 4 (10 =&gt; 25 by default)","children":[],"payload":{"lines":"136,137"}},{"content":"Use of Protected Users security groups","children":[],"payload":{"lines":"137,138"}},{"content":"Enforce password length","children":[],"payload":{"lines":"138,139"}}],"payload":{"lines":"134,135"}},{"content":"Links","children":[{"content":"<a href=\"http://for508.com/q09hg\">Cached logons &amp; CachedLogonsCount</a>","children":[],"payload":{"lines":"140,141"}},{"content":"<a href=\"http://for508.com/lwutc\">Domain Controller Security Technical Implementation Guide</a>","children":[],"payload":{"lines":"141,142"}}],"payload":{"lines":"139,140"}}],"payload":{"lines":"128,129"}},{"content":"LSA secrets","children":[{"content":"Info","children":[{"content":"Stored in the registry to allow services or tasks to be run with user privileges","children":[],"payload":{"lines":"144,145"}},{"content":"Can store application password like VPN or auto-logon creds","children":[],"payload":{"lines":"145,146"}},{"content":"The password is stored (not a hash)","children":[],"payload":{"lines":"146,147"}}],"payload":{"lines":"143,144"}},{"content":"Hunting/Defending","children":[{"content":"SECURITY\\Policy\\Secrets","children":[],"payload":{"lines":"148,149"}},{"content":"SECURITY\\Policy","children":[],"payload":{"lines":"149,150"}},{"content":"Do not employ services/schedule tasks requiring privileged accounts","children":[],"payload":{"lines":"150,151"}},{"content":"Reduce number of services requiring domain accounts","children":[],"payload":{"lines":"151,152"}},{"content":"Use (Group) Managed Service Accounts","children":[],"payload":{"lines":"152,153"}}],"payload":{"lines":"147,148"}},{"content":"Links","children":[{"content":"<a href=\"http://for508.com/80156\">Avoid password mgmt with group managed services accounts</a>","children":[],"payload":{"lines":"154,155"}}],"payload":{"lines":"153,154"}}],"payload":{"lines":"142,143"}},{"content":"Tickets","children":[{"content":"Info","children":[{"content":"Tickets are generated by Kerberos","children":[],"payload":{"lines":"157,158"}},{"content":"Tickets are chached in memory and are valid for 10 hours","children":[],"payload":{"lines":"158,159"}},{"content":"Can be used as Pass the Ticket","children":[],"payload":{"lines":"159,160"}},{"content":"DCs can provide ticket with no expiration (Golden ticket)","children":[],"payload":{"lines":"160,161"}}],"payload":{"lines":"156,157"}},{"content":"Kerberos Attacks detail / mitigation","children":[{"content":"<table data-lines=\"162,171\">\n<thead data-lines=\"162,163\">\n<tr data-lines=\"162,163\">\n<th>Attack Name</th>\n<th>Detail</th>\n<th>Mitigation</th>\n</tr>\n</thead>\n<tbody data-lines=\"164,171\">\n<tr data-lines=\"164,165\">\n<td>Pass the ticket</td>\n<td>Steal ticket from memory and pass or import on other systems</td>\n<td>Credential Guard; Remote Credential Guard</td>\n</tr>\n<tr data-lines=\"165,166\">\n<td>Overpass the Hash</td>\n<td>Use NT hash to request a service ticket for the same account</td>\n<td>Credential Guard; Protected Users Group; Disable RC4 authentication</td>\n</tr>\n<tr data-lines=\"166,167\">\n<td>Kerberoasting</td>\n<td>Request service ticket for highly privileged service &amp; crack NT hash</td>\n<td>Long &amp; complex service account passwords; Managed service account</td>\n</tr>\n<tr data-lines=\"167,168\">\n<td>Golden Ticket</td>\n<td>Kerberos TGT for any account with no expiration. Survives full password reset</td>\n<td>Protect domain admin accounts; change KRBTGT password regularly</td>\n</tr>\n<tr data-lines=\"168,169\">\n<td>Silver Ticket</td>\n<td>All-access pass for a single service or computer</td>\n<td>Regular computer account password update</td>\n</tr>\n<tr data-lines=\"169,170\">\n<td>Skeleton Key</td>\n<td>Patch LSASS on domain controller to add backdoor password that works for any domain account</td>\n<td>Protect domain admin accounts; smart card usage for privileged account</td>\n</tr>\n<tr data-lines=\"170,171\">\n<td>DCSync</td>\n<td>Use fake Domain Controller replication to retrieve hashes (and hash history) for any account without login to the DC</td>\n<td>Protect domain admin; audit/limit accounts with replication rights</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"lines":"162,171"}}],"payload":{"lines":"161,162"}},{"content":"Defending","children":[{"content":"Change KRBTGT password regularly","children":[],"payload":{"lines":"172,173"}},{"content":"Audit service accounts for unusual activity","children":[],"payload":{"lines":"173,174"}},{"content":"Credential Guard","children":[],"payload":{"lines":"174,175"}},{"content":"Remote Credential Guard","children":[],"payload":{"lines":"175,176"}},{"content":"Long &amp; complex passwords on service accounts","children":[],"payload":{"lines":"176,177"}}],"payload":{"lines":"171,172"}},{"content":"Links","children":[{"content":"<a href=\"http://for508.com/l-zh8\">Protecting Windows Networkds - Kerberos Attacks</a>","children":[],"payload":{"lines":"178,179"}},{"content":"<a href=\"http://for508.com/i3-4q\">Protection from Kerberos Golden ticket</a>","children":[],"payload":{"lines":"179,180"}},{"content":"<a href=\"http://for508.com/90fi6\">Exploring the limitations of Remote Credential Guard</a>","children":[],"payload":{"lines":"180,181"}},{"content":"<a href=\"http://for508.com/5acrs\">Github Kerberoast</a>","children":[],"payload":{"lines":"181,182"}},{"content":"<a href=\"htt://for508.com/2d0ho\">Kerberos in the Crosshairs: Golden tickets, Silver iickets, MITM and more</a>","children":[],"payload":{"lines":"182,183"}}],"payload":{"lines":"177,178"}}],"payload":{"lines":"155,156"}},{"content":"NTDS.DIT","children":[{"content":"Info","children":[{"content":"Stored in %SystemRoot%\\NTDS","children":[],"payload":{"lines":"185,186"}},{"content":"Location can be modified in HKLM\\SYSTEM\\CurrentControlSet\\Services\\NTDS\\Parameters","children":[],"payload":{"lines":"186,187"}}],"payload":{"lines":"184,185"}},{"content":"Links","children":[{"content":"<a href=\"http://for508.com/hfi9o\">GitHub - Bloodhound</a>","children":[],"payload":{"lines":"188,189"}},{"content":"<a href=\"http://for508.Com/2riwf\">Automating the Empire with Death Star</a><br>\n-<a href=\"http://for508.com/xdt0p\">GitHub - GoFetch</a>","children":[],"payload":{"lines":"189,192"}}],"payload":{"lines":"187,188"}}],"payload":{"lines":"183,184"}}],"payload":{"lines":"97,98"}}],"payload":{"lines":"61,62"}},{"content":"Program Execution","children":[{"content":"Prefetch","children":[{"content":"Info","children":[{"content":"The original purpose is to improve system performence","children":[],"payload":{"lines":"195,196"}},{"content":"FileName like : <appname>-&lt;PATH_HASH&gt;.pf</appname>","children":[],"payload":{"lines":"196,197"}},{"content":"Created after first execution of the app","children":[],"payload":{"lines":"197,198"}},{"content":"Logs all files and directories referenced by app","children":[],"payload":{"lines":"198,199"}},{"content":"Logs original path of execution","children":[],"payload":{"lines":"199,200"}},{"content":"Logs the total #of time app has been launched","children":[],"payload":{"lines":"200,201"}},{"content":"Logs the last time of execution","children":[],"payload":{"lines":"201,202"}},{"content":"From 128 files (win7 &amp; before) to 1024 files (Win10 - Win11)","children":[],"payload":{"lines":"202,203"}},{"content":"Logs dates with ~10 seconds of delay","children":[],"payload":{"lines":"203,205"}}],"payload":{"lines":"194,195"}},{"content":"Hunting","children":[{"content":"Files in c:\\Windows\\Prefetch","children":[],"payload":{"lines":"206,207"}},{"content":"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\PrefetchParameters - EnablePrefetcher key","children":[],"payload":{"lines":"207,208"}},{"content":"HKLM\\SYSTEM\\CurrentControlSet\\Services\\SysMain - Start key","children":[],"payload":{"lines":"208,209"}}],"payload":{"lines":"205,206"}},{"content":"Tool","children":[{"content":"Zimmerman's tool: PECmd.exe","children":[],"payload":{"lines":"210,211"}}],"payload":{"lines":"209,210"}},{"content":"Links","children":[{"content":"<a href=\"http://for508.com/rlhjb\">Prefetch Hash Calculator</a>","children":[],"payload":{"lines":"212,213"}},{"content":"<a href=\"http://for508.com/dv689\">Disabling Prefetch</a>","children":[],"payload":{"lines":"213,214"}},{"content":"<a href=\"http://for508.com/wu15h\">Wht's new in Windows Application Execution</a>","children":[],"payload":{"lines":"214,215"}}],"payload":{"lines":"211,212"}}],"payload":{"lines":"193,194"}},{"content":"ShimCache","children":[{"content":"Info","children":[{"content":"Original purpose: identify if an app needs to be shimmed for retro-compatibility","children":[],"payload":{"lines":"217,218"}},{"content":"Tracks Last modification date &amp; file path of the executable file","children":[],"payload":{"lines":"218,219"}},{"content":"Good for proving application was moved, renamed or timestamped","children":[],"payload":{"lines":"219,220"}},{"content":"Most recent events are on top (last OS versions do not record execute time)","children":[],"payload":{"lines":"220,221"}},{"content":"New entries are only written on shutdown (or reboot)","children":[],"payload":{"lines":"221,222"}},{"content":"/ ! \\ Since Vista, the InsertFlag does not guarantee the application was executed","children":[],"payload":{"lines":"222,223"}},{"content":"May be helpful to provide clue of existence of the tool if an attacker removed it &amp; the prefetch file","children":[],"payload":{"lines":"223,224"}}],"payload":{"lines":"216,217"}},{"content":"Hunting","children":[{"content":"SYSTEM\\CurrentControlSet\\Control\\SessionManager\\AppCompatCache\\AppCompatCache (Win7+) - 1024 entries, InsertFlag gives some indication of execution but it is not definitive","children":[],"payload":{"lines":"225,226"}},{"content":"SYSTEM\\CurrentControlSet\\Control\\SessionManager\\AppCompatibility\\AppCompatCache (WinXP-) - 96 entries, (2003 - up to 512)","children":[],"payload":{"lines":"226,227"}}],"payload":{"lines":"224,225"}},{"content":"Links","children":[{"content":"<a href=\"http://for508.com/g2msb\">Secrets of the Aplication Compatibility Database</a>","children":[],"payload":{"lines":"228,229"}},{"content":"<a href=\"http://for508.com/cyh3t\">Understanding Shims</a>","children":[],"payload":{"lines":"229,230"}},{"content":"<a href=\"http://for508.com/7pnmg\">Leveraging the application compatibility Cache in forensic investigation</a>","children":[],"payload":{"lines":"230,231"}}],"payload":{"lines":"227,228"}},{"content":"Tools","children":[{"content":"<a href=\"http://for508.com/tk6mb\">Zimmerman's AppCompatCacheParser</a>","children":[],"payload":{"lines":"232,233"}},{"content":"<a href=\"http://for508.com/ll4xr\">Mandiant's ShimCacheParser</a>","children":[],"payload":{"lines":"233,234"}}],"payload":{"lines":"231,232"}}],"payload":{"lines":"215,216"}},{"content":"AmCache","children":[{"content":"Info","children":[{"content":"Win7+ only","children":[],"payload":{"lines":"236,237"}},{"content":"Tracks installed applications, programs executed, drivers loaded &amp; more","children":[],"payload":{"lines":"237,238"}},{"content":"Provides full path, file size, SHA1 hash, publisher metada &amp; some timestamps of app &amp; driver","children":[],"payload":{"lines":"238,239"}},{"content":"Hash available for app &lt;= 31.4Mo (due to performance), but quite enougth for investigation purpose","children":[],"payload":{"lines":"239,240"}},{"content":"Entries can be due to automated file discovery or program installation.<br>\n=&gt; does not always indicate a program execution","children":[],"payload":{"lines":"240,242"}}],"payload":{"lines":"235,236"}},{"content":"Hunting","children":[{"content":"C:\\Windows\\AppCompat\\Programs\\Amcache.hve","children":[],"payload":{"lines":"243,244"}},{"content":"Can be used as an indication of executable &amp; driver presence on the system","children":[],"payload":{"lines":"244,245"}},{"content":"\"InventoryApplicationFile\" provides some information on the application<br>\nWe then can use the \"ProgramId\" to pivot to \"InventoryApplication\" to get more info","children":[],"payload":{"lines":"245,247"}},{"content":"\"InventoryDriverBinary\" provides info in drivers on the system<br>\nwe can look for anomalies hashes, signature, metadata or modification time (matching suspicious activity timeframe)","children":[],"payload":{"lines":"247,249"}}],"payload":{"lines":"242,243"}},{"content":"Tools","children":[{"content":"<a href=\"https://github.com/EricZimmerman/AmcacheParser\">Zimmerman's AmcacheParser</a>","children":[],"payload":{"lines":"250,251"}},{"content":"<a href=\"http://for508.com/7k3oi\">appcompatprocessor.py</a>","children":[],"payload":{"lines":"251,252"}},{"content":"<a href=\"http://for508.com/hg6uy\">ShimCache &amp; Amcache enterprise-wide hunting</a>","children":[],"payload":{"lines":"252,253"}}],"payload":{"lines":"249,250"}},{"content":"Links","children":[],"payload":{"lines":"253,254"}}],"payload":{"lines":"234,235"}}],"payload":{"lines":"192,193"}},{"content":"Lateral Movement","children":[{"content":"RDP - VNC - TeamViewer","children":[{"content":"Source Artifacts","children":[{"content":"EventLogs","children":[{"content":"Security.evtx: 4648","children":[],"payload":{"lines":"259,260"}},{"content":"Microsoft-Windows-TerminalServices-RDPClient%4Operational.evtx: 1024 &amp; 1102","children":[],"payload":{"lines":"260,261"}}],"payload":{"lines":"258,259"}},{"content":"Registry","children":[{"content":"NTUSER\\Siftware\\Microsoft\\Terminal Server Client\\Server - Remote Desktop destinations are tracked per user","children":[],"payload":{"lines":"262,263"}},{"content":"ShimCache SYSTEM - mstsc.exe =&gt; Remote Desktop Client","children":[],"payload":{"lines":"263,264"}},{"content":"BAM/DAM SYSTEM - Last time executed","children":[],"payload":{"lines":"264,265"}},{"content":"BAM/DAM - mstsc.exe","children":[],"payload":{"lines":"265,266"}},{"content":"AmCache.hve - mstsc.exe =&gt; First Time executed","children":[],"payload":{"lines":"266,267"}},{"content":"UserAssist NTUSER.DAT - mstsc.exe =&gt; Last Time &amp; #ofTime executed","children":[],"payload":{"lines":"267,268"}},{"content":"RecentApps NTUSER.DAT - mstsc.exe =&gt; Last Time &amp; #ofTime executed","children":[],"payload":{"lines":"268,269"}},{"content":"RecentApps NTUSER.DAT - mstsc.exe =&gt; RecentItems =&gt; connection destinations &amp; times","children":[],"payload":{"lines":"269,270"}}],"payload":{"lines":"261,262"}},{"content":"File System","children":[{"content":"JumpLists C:\\User&lt;USERNAME&gt;\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\AutomaticDestinations{MSTCS-APPID}-automaticDestinations-ms =&gt; Destination &amp; times","children":[],"payload":{"lines":"271,272"}},{"content":"Prefetch C:\\Windows\\Prefetch =&gt; mstsc.exe-<hash>.pf</hash>","children":[],"payload":{"lines":"272,273"}},{"content":"Bitmap Cache C:\\Users&lt;USERNAME&gt;\\AppData\\Local\\Microsoft\\Terminal Server Client\\Cache - bcache##.bmc","children":[],"payload":{"lines":"273,274"}},{"content":"Bitmap Cache C:\\Users&lt;USERNAME&gt;\\AppData\\Local\\Microsoft\\Terminal Server Client\\Cache - cache####.bmc","children":[],"payload":{"lines":"274,275"}}],"payload":{"lines":"270,271"}}],"payload":{"lines":"257,258"}},{"content":"Destination Artifacts","children":[{"content":"EventLogs","children":[{"content":"security.evtx - EventID 4624 logon type 10 =&gt; SourceIP &amp; UserName","children":[],"payload":{"lines":"277,278"}},{"content":"security.evtx - EventID 4778/4779 =&gt; SourceIP &amp; UserName","children":[],"payload":{"lines":"278,279"}},{"content":"Microsoft-Windows-RemoteDesktopServices-RdpCoreTS/Operational.evtx - EventID 131 =&gt; Connection attempts (SourceIP)","children":[],"payload":{"lines":"279,280"}},{"content":"Microsoft-Windows-TerminalServices-RemoteConnectionManager/Operational.evtx - EventID 98 =&gt; Successful connection","children":[],"payload":{"lines":"280,281"}},{"content":"Microsoft-Windows-TerminalServices-RemoteConnectionManager/Operational.evtx - EventID 1149 =&gt; SourceIP &amp; UserName (blank if using sticky key)","children":[],"payload":{"lines":"281,282"}},{"content":"Microsoft-Windows-TerminalServices-LocalSessionManager/Operational.evtx - EventID 21,22,25 =&gt; SourceIP &amp; UserName","children":[],"payload":{"lines":"282,283"}},{"content":"Microsoft-Windows-TerminalServices-LocalSessionManager/Operational.evtx - EventID 41 =&gt; UserName","children":[],"payload":{"lines":"283,284"}}],"payload":{"lines":"276,277"}},{"content":"Registry","children":[{"content":"ShimCache SYSTEM =&gt; rdpclip.exe &amp; tstheme.exe","children":[],"payload":{"lines":"285,286"}},{"content":"Amcache.hve - rdpclip.exe &amp; tstheme.exe =&gt; First Time executed","children":[],"payload":{"lines":"286,287"}}],"payload":{"lines":"284,285"}},{"content":"File System","children":[{"content":"Prefetch C:\\windows\\Prefetch - rdpclip.exe-<hash>.pf &amp; tstheme.exe-<hash>.pf</hash></hash>","children":[],"payload":{"lines":"288,289"}}],"payload":{"lines":"287,288"}}],"payload":{"lines":"275,276"}}],"payload":{"lines":"256,257"}},{"content":"Windows Admin Sharing","children":[{"content":"Source Artifacts","children":[{"content":"EventLogs","children":[{"content":"security.evtx - EventID 4648 =&gt; DestinationIP &amp; DestinationUserName, app","children":[],"payload":{"lines":"292,293"}},{"content":"Mcirosoft-Windows-SMBClient/Security.evtx EventID 31001 (Failed logon to destination) =&gt; Destination, UserName, reason why","children":[],"payload":{"lines":"293,294"}}],"payload":{"lines":"291,292"}},{"content":"Registry","children":[{"content":"NTUSER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MountPoints2 - Remotely mapped shares","children":[],"payload":{"lines":"295,296"}},{"content":"Shellbags USRCLASS.DAT - Remote folder accessed inside an interactive session via explorer","children":[],"payload":{"lines":"296,297"}},{"content":"ShimCache SYSTEM - net.exe &amp; net1.exe","children":[],"payload":{"lines":"297,298"}},{"content":"BAM/DAM NTUSER.DAT - net.exe &amp; net1.exe =&gt; Last execution time","children":[],"payload":{"lines":"298,299"}},{"content":"AmCache.hve - net.exe &amp; net1.exe =&gt; First execution time","children":[],"payload":{"lines":"299,300"}}],"payload":{"lines":"294,295"}},{"content":"File System","children":[{"content":"Prefetch C:\\windows\\Prefetch - net.exe-<hash>.pf &amp; net1.exe-<hash>.pf</hash></hash>","children":[],"payload":{"lines":"301,302"}}],"payload":{"lines":"300,301"}}],"payload":{"lines":"290,291"}},{"content":"Destination Artifacts","children":[{"content":"EventLogs","children":[{"content":"security.evtx - EventID 4624 logon type 3 =&gt; SourceIP &amp; UserName","children":[],"payload":{"lines":"304,305"}},{"content":"security.evtx - EventID 4772/4776 =&gt; SourceIP &amp; UserName","children":[],"payload":{"lines":"305,306"}},{"content":"security.evtx - EventID 4768/4679 TGT Granted/Service Ticket Granted =&gt; SourceIP &amp; UserName","children":[],"payload":{"lines":"306,307"}},{"content":"security.evtx - EventID 5140/5145 =&gt; Share Access/Auditing of shared files (noisy)","children":[],"payload":{"lines":"307,308"}}],"payload":{"lines":"303,304"}},{"content":"Registry","children":[{"content":"None","children":[],"payload":{"lines":"309,310"}}],"payload":{"lines":"308,309"}},{"content":"File System","children":[{"content":"File creation - Look for Modified Time before Creation Time","children":[],"payload":{"lines":"311,312"}},{"content":"File creation - Creation Time == Copy Time","children":[],"payload":{"lines":"312,314"}}],"payload":{"lines":"310,311"}}],"payload":{"lines":"302,303"}}],"payload":{"lines":"289,290"}},{"content":"PsExec","children":[{"content":"Source Artifacts","children":[{"content":"EventLogs","children":[{"content":"Security.evtx EventID 4648 =&gt; Current logged-on UserName, Altername UserName, DestinationIP, ProcesName","children":[],"payload":{"lines":"317,318"}}],"payload":{"lines":"316,317"}},{"content":"Registry","children":[{"content":"NTUSER\\Software\\SysInternals\\PsExec\\EulaAccepted","children":[],"payload":{"lines":"319,320"}},{"content":"ShimCache SYSTEM - psexec.exe","children":[],"payload":{"lines":"320,321"}},{"content":"BAM/DAM NTUSER.DAT - psexec.exe =&gt; Last execution time","children":[],"payload":{"lines":"321,322"}},{"content":"AmCache.hve - psexec.exe =&gt; First execution time","children":[],"payload":{"lines":"322,323"}}],"payload":{"lines":"318,319"}},{"content":"File System","children":[{"content":"Prefetch C:\\windows\\Prefetch - psexec.exe-<hash>.pf</hash>","children":[],"payload":{"lines":"324,325"}},{"content":"File Creation psexec.exe =&gt; file downloaded &amp; created on local host","children":[],"payload":{"lines":"325,326"}}],"payload":{"lines":"323,324"}},{"content":"Info - TIPS","children":[{"content":"Log activity is more important in destination UNLESS the attacker uses the \"runas\" option (eventID 4648).<br>\nIn that specific case, the source logs more stuff.","children":[],"payload":{"lines":"327,329"}}],"payload":{"lines":"326,327"}}],"payload":{"lines":"315,316"}},{"content":"Destination Artifacts","children":[{"content":"EventLogs","children":[{"content":"Security.evtx EventID 4624/4672 (logon type 3 (&amp;2 if alternative user account used))=&gt; -on UserName, SourceIP","children":[],"payload":{"lines":"331,332"}},{"content":"Security.evtx EventID 5140 =&gt; ADMIN$ share used by PsExec","children":[],"payload":{"lines":"332,333"}},{"content":"System.evtx EventID 7045 =&gt; Service installation","children":[],"payload":{"lines":"333,334"}}],"payload":{"lines":"330,331"}},{"content":"Registry","children":[{"content":"SYSTEM\\CurrentControlSet\\Services\\PSEXESVC - ('-r' option allows attacker to change service name)","children":[],"payload":{"lines":"335,336"}},{"content":"ShimCache SYSTEM - psexec.exe","children":[],"payload":{"lines":"336,337"}},{"content":"AmCache.hve - psexec.exe =&gt; First execution time","children":[],"payload":{"lines":"337,338"}}],"payload":{"lines":"334,335"}},{"content":"File System","children":[{"content":"Prefetch C:\\windows\\Prefetch - psexesvc.exe-<hash>.pf &amp; evil.exe-<hash>.pf</hash></hash>","children":[],"payload":{"lines":"339,340"}},{"content":"File Creation psexesvc.exe =&gt; in ADMIN$ by default as well as evil.exe","children":[],"payload":{"lines":"340,341"}},{"content":"User profile structure created unless '-e' option used","children":[],"payload":{"lines":"341,342"}}],"payload":{"lines":"338,339"}},{"content":"Info - TIPS","children":[{"content":"Multiple steps to remotly execute commands:<br>\na. Authenticate to the destination<br>\nb. Name pipe set up between source &amp; destination<br>\nc. ADMIN$ share mount on destination<br>\nd. PsExesvc &amp; binaries copied to destination<br>\ne. Windows service started &amp; cpoied files executed","children":[],"payload":{"lines":"343,349"}},{"content":"If script/binary created very close to the executoin of PSEXESVC.exe, the two are very likely related","children":[],"payload":{"lines":"349,350"}},{"content":"The Metasploit version of PsExec uses a random service name in exchange for Psexesvc, making<br>\nit easy to identify as evil. PsExec will create a user profile on the destination system by default.<br>\nThis presumes a profile doesn't already exist &amp; that the attacker did not include the '-e' option.<br>\nthe creation time of this profile &amp; it corresponding NTUSER.DAT registry data, can be another indicator of the PsExec activity","children":[],"payload":{"lines":"350,354"}},{"content":"RAM analysis can allows us to find named pipes. It may look like this:<br>\n\\<localip>\\pipe\\PSEXESVC-<sourcehostname>-<pid>-stdin<br>\n\\<localip>\\pipe\\PSEXESVC-<sourcehostname>-<pid>-stdout<br>\n\\<localip>\\pipe\\PSEXESVC-<sourcehostname>-<pid>-stderr</pid></sourcehostname></localip></pid></sourcehostname></localip></pid></sourcehostname></localip>","children":[],"payload":{"lines":"354,358"}},{"content":"If attacker can use '-r' option to change the name of PSEXESVC.<br>\nAll artifacts still good but anyway","children":[],"payload":{"lines":"358,360"}}],"payload":{"lines":"342,343"}}],"payload":{"lines":"329,330"}}],"payload":{"lines":"314,315"}},{"content":"Windows Remote Service","children":[{"content":"Source Artifacts","children":[{"content":"EventLogs","children":[{"content":"None","children":[],"payload":{"lines":"363,364"}}],"payload":{"lines":"362,363"}},{"content":"Registry","children":[{"content":"ShimCache SYSTEM - sc.exe","children":[],"payload":{"lines":"365,366"}},{"content":"AmCache.hve - sc.exe =&gt; First execution time","children":[],"payload":{"lines":"366,367"}},{"content":"BAM/DAM SYSTEM - sc.exe =&gt; Last execution time","children":[],"payload":{"lines":"367,368"}}],"payload":{"lines":"364,365"}},{"content":"File System","children":[{"content":"Prefetch C:\\windows\\Prefetch - sc.exe-<hash>.pf &amp; evil.exe-<hash>.pf</hash></hash>","children":[],"payload":{"lines":"369,370"}}],"payload":{"lines":"368,369"}}],"payload":{"lines":"361,362"}},{"content":"Destination Artifacts","children":[{"content":"EventLogs","children":[{"content":"security.evtx - EventID 4624 logon type 3 =&gt; SourceIP &amp; UserName","children":[],"payload":{"lines":"372,373"}},{"content":"security.evtx - EventID 4697 =&gt; Service install, if enabled","children":[],"payload":{"lines":"373,374"}},{"content":"system.evtx - EventID 7034 =&gt; Service crashed unexpectedly","children":[],"payload":{"lines":"374,375"}},{"content":"system.evtx - EventID 7035 =&gt; Service sent a Start/Stop control","children":[],"payload":{"lines":"375,376"}},{"content":"system.evtx - EventID 7036 =&gt; Service Started/Stoped","children":[],"payload":{"lines":"376,377"}},{"content":"system.evtx - EventID 7040 =&gt; Service Start type changed (Boot, On Request, Disabled)","children":[],"payload":{"lines":"377,378"}},{"content":"system.evtx - EventID 7045 =&gt; Service was installed on the system","children":[],"payload":{"lines":"378,379"}}],"payload":{"lines":"371,372"}},{"content":"Registry","children":[{"content":"SYSTEM\\CurrentControlSet\\Services =&gt; New service creation","children":[],"payload":{"lines":"380,381"}},{"content":"ShimCache SYSTEM - evil.exe =&gt; Records the existence of service executable unless implemented as a service DLL","children":[],"payload":{"lines":"381,382"}},{"content":"Amcache.hv - evil.exe =&gt; First execution time","children":[],"payload":{"lines":"382,383"}}],"payload":{"lines":"379,380"}},{"content":"File System","children":[{"content":"File Creation - evil.exe or evil.dll creation on disk","children":[],"payload":{"lines":"384,385"}},{"content":"Prefetch C:\\windows\\Prefetch - evil.exe-<hash>.pf</hash>","children":[],"payload":{"lines":"385,386"}}],"payload":{"lines":"383,384"}}],"payload":{"lines":"370,371"}}],"payload":{"lines":"360,361"}},{"content":"Windows Remote ScheduledTask","children":[{"content":"Source Artifacts","children":[{"content":"EventLogs","children":[{"content":"security.evtx EventID 4648  =&gt; DestinationIP, ProcessName &amp; UserNames","children":[],"payload":{"lines":"389,390"}}],"payload":{"lines":"388,389"}},{"content":"Registry","children":[{"content":"ShimCache SYSTEM - at.exe &amp; schtasks.exe","children":[],"payload":{"lines":"391,392"}},{"content":"AmCache.hve - at.exe &amp; schtasks.exe =&gt; First execution time","children":[],"payload":{"lines":"392,393"}},{"content":"BAM/DAM SYSTEM - at.exe &amp; schtasks.exe =&gt; Last execution time","children":[],"payload":{"lines":"393,394"}}],"payload":{"lines":"390,391"}},{"content":"File System","children":[{"content":"Prefetch C:\\windows\\Prefetch - schtasks.exe-<hash>.pf &amp; at.exe-<hash>.pf</hash></hash>","children":[],"payload":{"lines":"395,396"}}],"payload":{"lines":"394,395"}}],"payload":{"lines":"387,388"}},{"content":"Destination Artifacts","children":[{"content":"EventLogs","children":[{"content":"security.evtx - EventID 4624 logon type 3 =&gt; SourceIP &amp; UserName","children":[],"payload":{"lines":"398,399"}},{"content":"security.evtx - EventID 4672 =&gt; UserName, adminRights?, Requirement for default shares such as C$ or ADMIN$","children":[],"payload":{"lines":"399,400"}},{"content":"security.evtx - EventID 4698 =&gt; Scheduled Task created","children":[],"payload":{"lines":"400,401"}},{"content":"security.evtx - EventID 4702 =&gt; Scheduled Task updated","children":[],"payload":{"lines":"401,402"}},{"content":"security.evtx - EventID 4699 =&gt; Scheduled Task deleted","children":[],"payload":{"lines":"402,403"}},{"content":"security.evtx - EventID 4700/4701 =&gt; Scheduled Task Enabled/Disabled","children":[],"payload":{"lines":"403,404"}},{"content":"Microsoft-Windows-TaskScheduler/Operational.evtx EventID 106 =&gt; Scheduled Task created","children":[],"payload":{"lines":"404,405"}},{"content":"Microsoft-Windows-TaskScheduler/Operational.evtx EventID 140 =&gt; Scheduled Task updated","children":[],"payload":{"lines":"405,406"}},{"content":"Microsoft-Windows-TaskScheduler/Operational.evtx EventID 141 =&gt; Scheduled Task deleted","children":[],"payload":{"lines":"406,407"}},{"content":"Microsoft-Windows-TaskScheduler/Operational.evtx EventID 200/201 =&gt; Scheduled Task Executed/Completed","children":[],"payload":{"lines":"407,408"}}],"payload":{"lines":"397,398"}},{"content":"Registry","children":[{"content":"SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tasks","children":[],"payload":{"lines":"409,410"}},{"content":"SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tasks\\Tree","children":[],"payload":{"lines":"410,411"}},{"content":"ShimCache SYSTEM - evil.exe","children":[],"payload":{"lines":"411,412"}},{"content":"Amcache.hv - evil.exe =&gt; First execution time","children":[],"payload":{"lines":"412,413"}}],"payload":{"lines":"408,409"}},{"content":"File System","children":[{"content":"File Creation - evil.exe creation on disk","children":[],"payload":{"lines":"414,415"}},{"content":"Job Files Creation in C:\\Windows\\Tasks","children":[],"payload":{"lines":"415,416"}},{"content":"XML Task Files Creation in C:\\Windows\\System32\\Tasks","children":[],"payload":{"lines":"416,417"}},{"content":"Prefetch C:\\windows\\Prefetch - evil.exe-<hash>.pf</hash>","children":[],"payload":{"lines":"417,418"}}],"payload":{"lines":"413,414"}}],"payload":{"lines":"396,397"}}],"payload":{"lines":"386,387"}},{"content":"Windows Remote WMI","children":[{"content":"Source Artifacts","children":[{"content":"EventLogs","children":[{"content":"security.evtx EventID 4648  =&gt; DestinationIP, ProcessName &amp; UserNames","children":[],"payload":{"lines":"421,422"}}],"payload":{"lines":"420,421"}},{"content":"Registry","children":[{"content":"ShimCache SYSTEM - wmic.exe","children":[],"payload":{"lines":"423,424"}},{"content":"AmCache.hve - wmic.exe =&gt; First execution time","children":[],"payload":{"lines":"424,425"}},{"content":"BAM/DAM SYSTEM - wmic.exe =&gt; Last execution time","children":[],"payload":{"lines":"425,426"}}],"payload":{"lines":"422,423"}},{"content":"File System","children":[{"content":"Prefetch C:\\windows\\Prefetch - wmic.exe-<hash>.pf</hash>","children":[],"payload":{"lines":"427,428"}}],"payload":{"lines":"426,427"}}],"payload":{"lines":"419,420"}},{"content":"Destination Artifacts","children":[{"content":"EventLogs","children":[{"content":"security.evtx - EventID 4624 logon type 3 =&gt; SourceIP &amp; UserName","children":[],"payload":{"lines":"430,431"}},{"content":"security.evtx - EventID 4672 =&gt; UserName, adminRights?","children":[],"payload":{"lines":"431,432"}},{"content":"Microsoft-Windows-WMI-Activity/Operational.evtx EventID 5857 =&gt; Time of wmiprvse execution &amp; path to provider DLL","children":[],"payload":{"lines":"432,433"}},{"content":"Microsoft-Windows-WMI-Activity/Operational.evtx EventID 5860/5861 =&gt; Registration of temporaty/permanent event consumer","children":[],"payload":{"lines":"433,434"}}],"payload":{"lines":"429,430"}},{"content":"Registry","children":[{"content":"ShimCache SYSTEM - scrcons.exe, mofcomp.exe, winprvse.exe, evil.exe","children":[],"payload":{"lines":"435,436"}},{"content":"Amcache.hve - scrcons.exe, mofcomp.exe, winprvse.exe, evil.exe =&gt; First execution time","children":[],"payload":{"lines":"436,437"}}],"payload":{"lines":"434,435"}},{"content":"File System","children":[{"content":"File Creation - evil.exe &amp; evil.mof creation on disk","children":[],"payload":{"lines":"438,439"}},{"content":"Prefetch C:\\windows\\Prefetch - evil.exe-<hash>.pf, scrcons.exe-<hash>.pf, mofcomp.exe-<hash>.pf, winprvse.exe-<hash>.pf</hash></hash></hash></hash>","children":[],"payload":{"lines":"439,440"}},{"content":"Unauthorized changes to C:\\windows\\System32\\wbem\\Repository","children":[],"payload":{"lines":"440,441"}}],"payload":{"lines":"437,438"}}],"payload":{"lines":"428,429"}}],"payload":{"lines":"418,419"}},{"content":"Windows Remote PowerShell","children":[{"content":"Source Artifacts","children":[{"content":"EventLogs","children":[{"content":"security.evtx EventID 4648  =&gt; DestinationIP, ProcessName &amp; UserNames","children":[],"payload":{"lines":"444,445"}},{"content":"Microsoft-Windows-WMI/Operational.evtx EventID 6 =&gt; Session created, DestionationIP, UserName","children":[],"payload":{"lines":"445,446"}},{"content":"Microsoft-Windows-WMI/Operational.evtx EventID 8,15,16,33 =&gt; Session closed, DestionationIP, UserName","children":[],"payload":{"lines":"446,447"}},{"content":"Microsoft-Windows-PowerShell/Operational.evtx EventID 40691/40692 =&gt; Local initiation of powershell &amp; associated account","children":[],"payload":{"lines":"447,448"}},{"content":"Microsoft-Windows-PowerShell/Operational.evtx EventID 8193/8194 =&gt; Session created","children":[],"payload":{"lines":"448,449"}},{"content":"Microsoft-Windows-PowerShell/Operational.evtx EventID 8197 Connect =&gt; Session closed","children":[],"payload":{"lines":"449,450"}}],"payload":{"lines":"443,444"}},{"content":"Registry","children":[{"content":"ShimCache SYSTEM - powershell.exe","children":[],"payload":{"lines":"451,452"}},{"content":"AmCache.hve - powershell.exe =&gt; First execution time","children":[],"payload":{"lines":"452,453"}},{"content":"BAM/DAM SYSTEM - powershell.exe =&gt; Last execution time","children":[],"payload":{"lines":"453,454"}}],"payload":{"lines":"450,451"}},{"content":"File System","children":[{"content":"Prefetch C:\\windows\\Prefetch - powershell.exe-<hash>.pf =&gt; ps1 file will be tracked</hash>","children":[],"payload":{"lines":"455,456"}},{"content":"C:\\Users&lt;USERNAME&gt;\\AppData\\Roaming\\Microsoft\\Windows\\Powershell\\PSReadline\\ConsoleHost_history.txt =&gt; last 4096 commands launched by user","children":[],"payload":{"lines":"456,457"}}],"payload":{"lines":"454,455"}}],"payload":{"lines":"442,443"}},{"content":"Destination Artifacts","children":[{"content":"EventLogs","children":[{"content":"security.evtx - EventID 4624 logon type 3 =&gt; SourceIP &amp; UserName","children":[],"payload":{"lines":"459,460"}},{"content":"security.evtx - EventID 4672 =&gt; UserName, adminRights?","children":[],"payload":{"lines":"460,461"}},{"content":"Microsoft-Windows-WinRM/Operational.evtx EventID 91 =&gt; Session created","children":[],"payload":{"lines":"461,462"}},{"content":"Microsoft-Windows-WinRM/Operational.evtx EventID 168 =&gt; Recodes the authenticating user","children":[],"payload":{"lines":"462,463"}},{"content":"Microsoft-Windows-PowerShell/Operational.evtx EventID 400/403 =&gt; Indicate start/end of remoting session","children":[],"payload":{"lines":"463,464"}},{"content":"Microsoft-Windows-PowerShell/Operational.evtx EventID 800 =&gt; Include partial script code","children":[],"payload":{"lines":"464,465"}}],"payload":{"lines":"458,459"}},{"content":"Registry","children":[{"content":"ShimCache SYSTEM - wsmprovhost.exe, evil.exe","children":[],"payload":{"lines":"466,467"}},{"content":"Amcache.hve - wsmprovhost.exe, evil.exe =&gt; First execution time","children":[],"payload":{"lines":"467,468"}},{"content":"SOFTWARE\\Microsoft\\PowerShell\\1\\shellIds\\Microsoft.PowerShell\\ExecutionPolicy =&gt; May changed by attacker to reduce restriction","children":[],"payload":{"lines":"468,469"}}],"payload":{"lines":"465,466"}},{"content":"File System","children":[{"content":"File Creation - evil.exe creation on disk","children":[],"payload":{"lines":"470,471"}},{"content":"File Creation - User profile directory (is 'Enter-PSSession' is used)","children":[],"payload":{"lines":"471,472"}},{"content":"Prefetch C:\\windows\\Prefetch - evil.exe-<hash>.pf, wsmprovhost.exe-<hash>.pf</hash></hash>","children":[],"payload":{"lines":"472,473"}}],"payload":{"lines":"469,470"}}],"payload":{"lines":"457,458"}}],"payload":{"lines":"441,442"}},{"content":"Other","children":[{"content":"Application Deployment Software","children":[{"content":"Patch/application deployment tool are legitimate tools.<br>\nIt implies that accounts &amp; systems used in the patch deployment process must be heavily monitored","children":[],"payload":{"lines":"475,477"}}],"payload":{"lines":"474,475"}},{"content":"Vulnerability Exploitation","children":[{"content":"Patch it !!!","children":[],"payload":{"lines":"478,479"}}],"payload":{"lines":"477,478"}}],"payload":{"lines":"473,474"}},{"content":"Links","children":[{"content":"<a href=\"http://for508.com/xp-gf\">RDP Bitmap Cache parser</a>","children":[],"payload":{"lines":"480,482"}}],"payload":{"lines":"479,480"}}],"payload":{"lines":"255,256"}},{"content":"(Native) EventLogs","children":[{"content":"<table data-lines=\"483,497\">\n<thead data-lines=\"483,484\">\n<tr data-lines=\"483,484\">\n<th>What</th>\n<th>EvtxName</th>\n<th>EventID</th>\n</tr>\n</thead>\n<tbody data-lines=\"485,497\">\n<tr data-lines=\"485,486\">\n<td>Logons</td>\n<td>Security</td>\n<td>4624, 4625, 4634, 4647<br>4648, 4672, 4720, 4726</td>\n</tr>\n<tr data-lines=\"486,487\">\n<td>Account Logon</td>\n<td>Security</td>\n<td>4768, 4769, 4771, 4776</td>\n</tr>\n<tr data-lines=\"487,488\">\n<td>RDP</td>\n<td>Security<br>RDPCLient<br>RDPCoreTS<br>RemoteConnectionManager</td>\n<td>4624, 4625, 4778, 4779<br>1024, 1102<br>98, 131<br>1149</td>\n</tr>\n<tr data-lines=\"488,489\">\n<td>Network Shares</td>\n<td>Security</td>\n<td>5140-5145</td>\n</tr>\n<tr data-lines=\"489,490\">\n<td>Sceduled Tasks</td>\n<td>Security<br>Task Scheduler</td>\n<td>4698<br>106, 140-141, 200-201</td>\n</tr>\n<tr data-lines=\"490,491\">\n<td>Installation</td>\n<td>Application</td>\n<td>1033, 1034, 11707, 11708, 11724</td>\n</tr>\n<tr data-lines=\"491,492\">\n<td>Services</td>\n<td>System<br>Security</td>\n<td>7034-7036, 7040, 7045<br>4697</td>\n</tr>\n<tr data-lines=\"492,493\">\n<td>Log Clearing</td>\n<td>Security<br>System</td>\n<td>1102<br>104</td>\n</tr>\n<tr data-lines=\"493,494\">\n<td>Malware Execution</td>\n<td>Security<br>System<br>Application</td>\n<td>4688<br>1001<br>1000-1002</td>\n</tr>\n<tr data-lines=\"494,495\">\n<td>Anti-Malware Log</td>\n<td>Windows-Defender/Operational</td>\n<td>1116-1119</td>\n</tr>\n<tr data-lines=\"495,496\">\n<td>Command Lines</td>\n<td>Security<br>PowerShell/Operational</td>\n<td>4688<br>4103-4104</td>\n</tr>\n<tr data-lines=\"496,497\">\n<td>WMI</td>\n<td>WMI-Activity/Operational</td>\n<td>5857-5861</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"lines":"483,497"}}],"payload":{"lines":"482,483"}},{"content":"Memory analysis","children":[{"content":"Acquisition","children":[{"content":"Live System","children":[{"content":"<a href=\"https://github.com/Velocidex/c-aff4/releases\">WinPMEM</a>","children":[],"payload":{"lines":"501,502"}},{"content":"<a href=\"https://magnetforensics.com/free-tool-magnet-ram-capture\">MagnetForensics RAM Capture</a>","children":[],"payload":{"lines":"502,503"}},{"content":"<a href=\"https://forensic.belkasoft.com/en/ram-capturer\">Belkasoft Live RAM Capturer</a>","children":[],"payload":{"lines":"503,504"}},{"content":"<a href=\"https://www.f-response.com\">F-Response</a>","children":[],"payload":{"lines":"504,505"}}],"payload":{"lines":"500,501"}},{"content":"Dead System","children":[{"content":"Hibernation files - %SystemDrive%\\hiberfil.sys - Contains a compressed RAM Image","children":[],"payload":{"lines":"506,507"}},{"content":"Pages &amp; Swap files - %SystemDrive%{pagefile.sys, swapfile.sys} - swapfile.sys =&gt; Win8+/2012+","children":[],"payload":{"lines":"507,508"}},{"content":"Kernel-Mode dump files - %SystemRoot%\\MEMORY.DMP","children":[],"payload":{"lines":"508,509"}},{"content":"SYSTEM\\CurrentControlSet\\Control\\CrashControl","children":[],"payload":{"lines":"509,510"}},{"content":"SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management","children":[],"payload":{"lines":"510,511"}}],"payload":{"lines":"505,506"}},{"content":"Links/Info","children":[{"content":"MemProcFS can analyse these page files<br>\n-<a href=\"http://for508.com/erw8g\">PMEM Memory acquisition suite</a><br>\n-<a href=\"http://for508.com/b4d1f\">Varieties of Kernel-Mode Dump files</a><br>\n-<a href=\"http://for508.com/9qc31\">Overview of memory dump file options for Windows</a><br>\n-<a href=\"http://for508.com/mnzdt\">Win8/2012: the new swap file</a><br>\n-<a href=\"http://for508.com/erw8g\">VMWare snapshot file</a>","children":[],"payload":{"lines":"512,518"}}],"payload":{"lines":"511,512"}}],"payload":{"lines":"499,500"}},{"content":"Hibernation file tools","children":[{"content":"Decompress to raw","children":[{"content":"Volatility v2's imagecopy plugin","children":[],"payload":{"lines":"520,521"}},{"content":"Volatility v3's layerwriter plugin","children":[],"payload":{"lines":"521,522"}},{"content":"hibr2bin.exe (not updated, so far, can't use on win10+)","children":[],"payload":{"lines":"522,523"}},{"content":"Arsenal's Hibernation Recon tool","children":[],"payload":{"lines":"523,524"}}],"payload":{"lines":"519,520"}},{"content":"Analyse natively","children":[{"content":"BulkExtractor","children":[],"payload":{"lines":"525,526"}},{"content":"Magnet AXIOM","children":[],"payload":{"lines":"526,527"}},{"content":"Volatility","children":[],"payload":{"lines":"527,528"}},{"content":"Passware","children":[],"payload":{"lines":"528,529"}}],"payload":{"lines":"524,525"}}],"payload":{"lines":"518,519"}},{"content":"Performing Memory Analysis","children":[{"content":"Schema","children":[{"content":"<img src=\"./KDBG.png\" alt=\"Schema\">","children":[],"payload":{"lines":"531,532"}}],"payload":{"lines":"530,531"}},{"content":"Identify Rogue Processes","children":[],"payload":{"lines":"532,533"}},{"content":"Analyze process objects","children":[],"payload":{"lines":"534,535"}},{"content":"Review network artifacts","children":[],"payload":{"lines":"535,536"}},{"content":"Look for evidence of code injection","children":[],"payload":{"lines":"536,537"}},{"content":"Audit drivers and rootkit detection","children":[],"payload":{"lines":"537,538"}},{"content":"Dump suspicious processes &amp; drivers","children":[],"payload":{"lines":"538,539"}}],"payload":{"lines":"529,530"}},{"content":"Links","children":[{"content":"<a href=\"https://for508.com/b7s4n\">Finding Kernel Global Variables</a>","children":[],"payload":{"lines":"540,541"}},{"content":"<a href=\"https://for508.com/lz8pi\">Volatility CheatSheet</a>","children":[],"payload":{"lines":"541,542"}}],"payload":{"lines":"539,540"}}],"payload":{"lines":"498,499"}}]},{"colorFreezeLevel":2,"initialExpandLevel":2})</script>
</body>
</html>
